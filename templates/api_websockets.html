{% extends "base.html" %}

{% block content %}
<!-- WebSocket API Hero Section -->
<section class="websocket-hero">
    <div class="container">
        <div class="breadcrumb">
            <a href="/api">API Documentation</a>
            <i class="fas fa-chevron-right"></i>
            <span>WebSocket API</span>
        </div>
        <h1 class="page-title">
            <i class="fas fa-exchange-alt"></i>
            WebSocket API
        </h1>
        <p class="page-description">
            Real-time bidirectional communication with AI agents through WebSocket connections. 
            Perfect for live chat, streaming responses, and interactive applications.
        </p>
    </div>
</section>

<!-- WebSocket Content -->
<section class="websocket-content">
    <div class="container">
        <div class="content-wrapper">
            <div class="connection-info">
                <h2>Connection Details</h2>
                <div class="connection-card">
                    <h3>WebSocket Endpoint</h3>
                    <div class="endpoint-display">
                        <code>wss://ws.intelcoreai.com/v1/chat</code>
                        <button class="copy-btn-small" onclick="copyText('wss://ws.intelcoreai.com/v1/chat')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <div class="connection-flow">
                    <h3>Connection Flow</h3>
                    <div class="flow-steps">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Connect</h4>
                                <p>Establish WebSocket connection</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Authenticate</h4>
                                <p>Send authentication message</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Exchange</h4>
                                <p>Send/receive messages</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="examples-section">
                <h2>Implementation Examples</h2>
                
                <div class="tabs">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showTab('javascript')">JavaScript</button>
                        <button class="tab-btn" onclick="showTab('python')">Python</button>
                        <button class="tab-btn" onclick="showTab('nodejs')">Node.js</button>
                    </div>

                    <div id="javascript" class="tab-content active">
                        <div class="code-block">
                            <div class="code-header">
                                <span>JavaScript WebSocket Client</span>
                                <button class="copy-btn" onclick="copyCode('js-websocket')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <pre id="js-websocket"><code>const socket = new WebSocket('wss://ws.intelcoreai.com/v1/chat');

// Connection opened
socket.onopen = function(event) {
    console.log('Connected to AI Digital Friend WebSocket');
    
    // Authenticate
    socket.send(JSON.stringify({
        type: 'auth',
        api_key: 'YOUR_API_KEY'
    }));
};

// Listen for messages
socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    
    switch(data.type) {
        case 'auth_success':
            console.log('Authentication successful');
            // Start chatting
            socket.send(JSON.stringify({
                type: 'message',
                content: 'Hello AI Friend!',
                model: 'ai-friend-pro'
            }));
            break;
            
        case 'message':
            console.log('AI Response:', data.content);
            displayMessage(data.content);
            break;
            
        case 'error':
            console.error('Error:', data.message);
            break;
    }
};

// Connection closed
socket.onclose = function(event) {
    console.log('Connection closed');
};

// Send a message
function sendMessage(content) {
    if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({
            type: 'message',
            content: content,
            model: 'ai-friend-pro',
            stream: true
        }));
    }
}</code></pre>
                        </div>
                    </div>

                    <div id="python" class="tab-content">
                        <div class="code-block">
                            <div class="code-header">
                                <span>Python WebSocket Client</span>
                                <button class="copy-btn" onclick="copyCode('python-websocket')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <pre id="python-websocket"><code>import asyncio
import websockets
import json

async def chat_with_ai():
    uri = "wss://ws.intelcoreai.com/v1/chat"
    
    async with websockets.connect(uri) as websocket:
        # Authenticate
        auth_message = {
            "type": "auth",
            "api_key": "YOUR_API_KEY"
        }
        await websocket.send(json.dumps(auth_message))
        
        # Wait for authentication response
        auth_response = await websocket.recv()
        auth_data = json.loads(auth_response)
        
        if auth_data["type"] == "auth_success":
            print("Connected successfully!")
            
            # Send a message
            message = {
                "type": "message",
                "content": "What's the weather like today?",
                "model": "ai-friend-pro",
                "stream": True
            }
            await websocket.send(json.dumps(message))
            
            # Listen for responses
            async for message in websocket:
                data = json.loads(message)
                
                if data["type"] == "message":
                    print(f"AI: {data['content']}")
                elif data["type"] == "stream_chunk":
                    print(data['chunk'], end='', flush=True)
                elif data["type"] == "stream_end":
                    print("\n--- Stream ended ---")

# Run the client
asyncio.run(chat_with_ai())</code></pre>
                        </div>
                    </div>

                    <div id="nodejs" class="tab-content">
                        <div class="code-block">
                            <div class="code-header">
                                <span>Node.js WebSocket Client</span>
                                <button class="copy-btn" onclick="copyCode('nodejs-websocket')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <pre id="nodejs-websocket"><code>const WebSocket = require('ws');

const ws = new WebSocket('wss://ws.intelcoreai.com/v1/chat');

ws.on('open', function open() {
    console.log('Connected to AI Digital Friend');
    
    // Authenticate
    ws.send(JSON.stringify({
        type: 'auth',
        api_key: process.env.INTELCORE_API_KEY
    }));
});

ws.on('message', function message(data) {
    const parsed = JSON.parse(data.toString());
    
    switch(parsed.type) {
        case 'auth_success':
            console.log('Authentication successful');
            
            // Start conversation
            ws.send(JSON.stringify({
                type: 'message',
                content: 'Help me plan a vacation',
                model: 'ai-friend-pro',
                conversation_id: 'unique-session-id'
            }));
            break;
            
        case 'message':
            console.log('AI Response:', parsed.content);
            break;
            
        case 'typing_indicator':
            console.log('AI is typing...');
            break;
            
        case 'error':
            console.error('Error:', parsed.message);
            break;
    }
});

ws.on('close', function close() {
    console.log('Disconnected from AI Digital Friend');
});

ws.on('error', function error(err) {
    console.error('WebSocket error:', err);
});</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="message-types">
                <h2>Message Types</h2>
                <div class="message-grid">
                    <div class="message-card">
                        <h3>Authentication</h3>
                        <div class="message-example">
                            <h4>Send:</h4>
                            <pre><code>{
  "type": "auth",
  "api_key": "YOUR_API_KEY"
}</code></pre>
                            <h4>Receive:</h4>
                            <pre><code>{
  "type": "auth_success",
  "user_id": "user123",
  "rate_limit": {
    "requests_per_minute": 60
  }
}</code></pre>
                        </div>
                    </div>

                    <div class="message-card">
                        <h3>Chat Message</h3>
                        <div class="message-example">
                            <h4>Send:</h4>
                            <pre><code>{
  "type": "message",
  "content": "Hello AI!",
  "model": "ai-friend-pro",
  "stream": true,
  "conversation_id": "conv123"
}</code></pre>
                            <h4>Receive:</h4>
                            <pre><code>{
  "type": "message",
  "content": "Hello! How can I help you?",
  "message_id": "msg456",
  "conversation_id": "conv123"
}</code></pre>
                        </div>
                    </div>

                    <div class="message-card">
                        <h3>Streaming Response</h3>
                        <div class="message-example">
                            <h4>Receive (chunks):</h4>
                            <pre><code>{
  "type": "stream_chunk",
  "chunk": "Hello",
  "message_id": "msg456"
}

{
  "type": "stream_chunk",
  "chunk": " there!",
  "message_id": "msg456"
}

{
  "type": "stream_end",
  "message_id": "msg456"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="features-section">
                <h2>WebSocket Features</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Real-time Streaming</h3>
                        <p>Receive AI responses as they're generated for immediate user feedback</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3>Persistent Conversations</h3>
                        <p>Maintain conversation context across multiple message exchanges</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-keyboard"></i>
                        </div>
                        <h3>Typing Indicators</h3>
                        <p>Show when AI is processing and generating responses</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h3>Connection Management</h3>
                        <p>Automatic reconnection and heartbeat for reliable connections</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.websocket-hero {
    padding: 100px 0 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    font-size: 0.9rem;
}

.breadcrumb a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
}

.breadcrumb a:hover {
    color: white;
}

.breadcrumb i {
    font-size: 0.7rem;
    opacity: 0.6;
}

.page-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    line-height: 1.2;
}

.page-title i {
    margin-right: 1rem;
    color: rgba(255, 255, 255, 0.8);
}

.page-description {
    font-size: 1.3rem;
    opacity: 0.9;
    line-height: 1.6;
    max-width: 600px;
}

.websocket-content {
    padding: 80px 0;
    background: #f8fafc;
}

.content-wrapper {
    max-width: 1200px;
    margin: 0 auto;
}

.connection-info {
    background: white;
    padding: 3rem;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 3rem;
}

.connection-info h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.connection-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
}

.connection-card h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-primary);
}

.endpoint-display {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #1e293b;
    border-radius: 8px;
}

.endpoint-display code {
    flex: 1;
    background: none;
    color: #e2e8f0;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 1.1rem;
}

.copy-btn-small {
    background: transparent;
    border: 1px solid #475569;
    color: #e2e8f0;
    padding: 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.copy-btn-small:hover {
    background: #475569;
}

.connection-flow h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.flow-steps {
    display: flex;
    align-items: center;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
}

.flow-step {
    text-align: center;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.5rem;
    min-width: 150px;
}

.step-number {
    width: 40px;
    height: 40px;
    background: #667eea;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-weight: 700;
    font-size: 1.1rem;
}

.step-content h4 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.step-content p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.flow-arrow {
    font-size: 2rem;
    color: #667eea;
    font-weight: 700;
}

.examples-section {
    background: white;
    padding: 3rem;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 3rem;
}

.examples-section h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.tabs {
    margin: 2rem 0;
}

.tab-buttons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
}

.tab-btn {
    padding: 0.75rem 1.5rem;
    background: #f1f5f9;
    border: 2px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.tab-btn.active {
    background: #667eea;
    color: white;
}

.tab-btn:hover:not(.active) {
    background: #e2e8f0;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.code-block {
    background: #1e1e1e;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.code-header {
    background: #2d2d30;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #3e3e42;
}

.code-header span {
    color: #cccccc;
    font-weight: 600;
    font-size: 0.9rem;
}

.copy-btn {
    background: transparent;
    border: 1px solid #555;
    color: #cccccc;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.copy-btn:hover {
    background: #555;
    border-color: #777;
}

.code-block pre {
    padding: 1.5rem;
    margin: 0;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 0.85rem;
    line-height: 1.6;
    color: #e6e6e6;
    overflow-x: auto;
}

.message-types {
    background: white;
    padding: 3rem;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 3rem;
}

.message-types h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.message-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
}

.message-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 2rem;
}

.message-card h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
}

.message-example h4 {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 1rem 0 0.5rem;
    color: var(--text-primary);
}

.message-example h4:first-child {
    margin-top: 0;
}

.message-example pre {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 8px;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 0.85rem;
    line-height: 1.5;
    overflow-x: auto;
    margin-bottom: 1rem;
}

.features-section {
    background: white;
    padding: 3rem;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.features-section h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--text-primary);
    text-align: center;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
}

.feature-card {
    text-align: center;
    padding: 2rem;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.feature-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.feature-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
}

.feature-icon i {
    font-size: 2rem;
    color: white;
}

.feature-card h3 {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-primary);
}

.feature-card p {
    color: var(--text-secondary);
    line-height: 1.6;
}

@media (max-width: 768px) {
    .page-title {
        font-size: 2rem;
    }
    
    .connection-info,
    .examples-section,
    .message-types,
    .features-section {
        padding: 2rem;
    }
    
    .flow-steps {
        flex-direction: column;
        gap: 1rem;
    }
    
    .flow-arrow {
        transform: rotate(90deg);
    }
    
    .tab-buttons {
        flex-wrap: wrap;
    }
    
    .message-grid {
        grid-template-columns: 1fr;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));
    
    // Remove active class from all buttons
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => btn.classList.remove('active'));
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Add active class to clicked button
    event.target.classList.add('active');
}

function copyCode(elementId) {
    const code = document.getElementById(elementId).textContent;
    navigator.clipboard.writeText(code).then(() => {
        const btn = event.target.closest('.copy-btn');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied';
        setTimeout(() => {
            btn.innerHTML = originalHTML;
        }, 2000);
    });
}

function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target.closest('.copy-btn-small');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
            btn.innerHTML = originalHTML;
        }, 2000);
    });
}
</script>
{% endblock %}