<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - AI Agents Platform</title>
    <link href="/static/main.css" rel="stylesheet">
    <style>
        .chat-container {
            max-width: 800px;
            margin: 2rem auto;
            height: 80vh;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .agent-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.user .message-content {
            background: #007bff;
            color: white;
        }
        
        .message.agent .message-content {
            background: white;
            border: 1px solid #dee2e6;
        }
        
        .chat-input {
            padding: 1rem;
            border-top: 1px solid #dee2e6;
            background: white;
            border-radius: 0 0 10px 10px;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
        }
        
        .input-group input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 20px;
            outline: none;
        }
        
        .input-group input:focus {
            border-color: #007bff;
        }
        
        .send-btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn:hover {
            background: #0056b3;
        }
        
        .typing-indicator {
            display: none;
            padding: 0.5rem 1rem;
            color: #6c757d;
            font-style: italic;
        }
        
        .status-online {
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="agent-avatar">{{ agent.personality.avatar if agent.personality else 'ðŸ¤–' }}</div>
            <div>
                <h3>{{ agent.name }}</h3>
                <p style="margin: 0; opacity: 0.8;">{{ agent.role }}</p>
                <span class="status-online"></span> Online
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message agent">
                <div class="message-content">
                    Hello! I'm {{ agent.name }}, {{ agent.description }}. How can I assist you today?
                </div>
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            {{ agent.name }} is typing...
        </div>
        
        <div class="chat-input">
            <div class="input-group">
                <input type="text" id="messageInput" placeholder="Type your message..." maxlength="500">
                <button class="send-btn" id="sendBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const agentId = '{{ agent_id }}';
        
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'agent'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showTyping() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }
        
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            sendBtn.disabled = true;
            
            // Show typing indicator
            showTyping();
            
            try {
                const response = await fetch(`/chat/${agentId}/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });
                
                const data = await response.json();
                
                // Simulate typing delay
                setTimeout(() => {
                    hideTyping();
                    
                    if (data.success) {
                        addMessage(data.response);
                    } else {
                        addMessage('Sorry, I encountered an error. Please try again.');
                    }
                    
                    sendBtn.disabled = false;
                }, 1000 + Math.random() * 2000); // 1-3 second delay
                
            } catch (error) {
                console.error('Error:', error);
                hideTyping();
                addMessage('Sorry, I encountered a connection error. Please try again.');
                sendBtn.disabled = false;
            }
        }
        
        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Auto-focus input
        messageInput.focus();
        
        // Welcome message after a short delay
        setTimeout(() => {
            const welcomeMessages = [
                "I'm ready to help you with strategic planning and analysis.",
                "Feel free to ask me anything about wellness and mental health.",
                "I can help you research and gather information on any topic.",
                "Let me know if you need help with data analysis or insights."
            ];
            
            // Different welcome message based on agent
            const agentWelcomes = {
                'strategist': "I'm ready to help you with strategic planning and tactical analysis.",
                'healer': "I'm here to support your wellness journey and mental health.",
                'scout': "I can help you research and gather intelligence on any topic.",
                'analyst': "Let me know if you need help with data analysis or insights."
            };
            
            const welcome = agentWelcomes[agentId] || "How can I assist you today?";
            addMessage(welcome);
        }, 500);
    </script>
</body>
</html>